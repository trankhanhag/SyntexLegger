SPEC T√çNH PH√ç 

M√¥ h√¨nh: Free Until Meaningful + Subscription theo m·ª©c tr∆∞·ªüng th√†nh

1. M·ª•c ti√™u thi·∫øt k·∫ø (Design Goals)

Gi·∫£m ma s√°t onboarding = 0

DN m·ªõi d√πng ho√†n to√†n mi·ªÖn ph√≠

Kh√¥ng y√™u c·∫ßu th·∫ª, kh√¥ng trial ƒë·∫øm ng√†y

T√≠nh ph√≠ khi DN th·ª±c s·ª± ho·∫°t ƒë·ªông

Kh√¥ng thu ti·ªÅn khi DN c√≤n ‚Äúch·∫øt l√¢m s√†ng‚Äù

Thu ti·ªÅn khi ƒë√£ c√≥:

ph√°t sinh

doanh thu

nhu c·∫ßu qu·∫£n tr·ªã

Kh√¥ng ph√° tr·∫£i nghi·ªám k·∫ø to√°n

Kh√¥ng kh√≥a nghi·ªáp v·ª• ƒë·ªôt ng·ªôt

Kh√¥ng t√≠nh ti·ªÅn theo h√†nh ƒë·ªông

2. Kh√°i ni·ªám & thu·∫≠t ng·ªØ
2.1 Company Lifecycle State (CLS)

M·ªói doanh nghi·ªáp lu√¥n ·ªü 1 tr·∫°ng th√°i duy nh·∫•t:

INIT ‚Üí FREE_ACTIVE ‚Üí PRE_BILLING ‚Üí PAID_ACTIVE ‚Üí SUSPENDED

State	√ù nghƒ©a
INIT	T·∫°o DN nh∆∞ng ch∆∞a ph√°t sinh
FREE_ACTIVE	ƒêang d√πng mi·ªÖn ph√≠
PRE_BILLING	ƒê√£ v∆∞·ª£t ng∆∞·ª°ng, trong th·ªùi gian ƒë·ªám
PAID_ACTIVE	ƒêang tr·∫£ ph√≠
SUSPENDED	Qu√° h·∫°n thanh to√°n
3. C√°c ch·ªâ s·ªë d√πng ƒë·ªÉ k√≠ch ho·∫°t t√≠nh ph√≠ (Billing Triggers)
3.1 C√°c ch·ªâ s·ªë ch√≠nh (Primary Metrics)
Code	Ch·ªâ s·ªë	ƒê∆°n v·ªã
M1	T·ªïng s·ªë b√∫t to√°n	count / nƒÉm
M2	Doanh thu ghi nh·∫≠n	VND / nƒÉm
M3	S·ªë h√≥a ƒë∆°n ƒëi·ªán t·ª≠	count
M4	S·ªë th√°ng c√≥ ph√°t sinh	month
M5	S·ªë user	count
M6	Ph·∫ßn h√†nh n√¢ng cao	boolean
3.2 Ng∆∞·ª°ng m·∫∑c ƒë·ªãnh (Configurable)
FREE_LIMITS:
  journal_entries_per_year: 1000
  revenue_per_year: 2_000_000_000
  invoices_total: 100
  active_months: 4
  users: 1
  advanced_modules_enabled: false


‚ö†Ô∏è C√°c gi√° tr·ªã ph·∫£i c·∫•u h√¨nh ƒë∆∞·ª£c, kh√¥ng hard-code.

4. Quy t·∫Øc chuy·ªÉn tr·∫°ng th√°i (State Transition Rules)
4.1 INIT ‚Üí FREE_ACTIVE

ƒêi·ªÅu ki·ªán

T·∫°o √≠t nh·∫•t 1 b√∫t to√°n

Ho·∫∑c nh·∫≠p s·ªë d∆∞ ƒë·∫ßu k·ª≥

4.2 FREE_ACTIVE ‚Üí PRE_BILLING

K√≠ch ho·∫°t khi ‚â• 1 ƒëi·ªÅu ki·ªán ƒë√∫ng:

M1 > journal_entries_per_year
OR M2 > revenue_per_year
OR M3 > invoices_total
OR M4 > active_months
OR M5 > users
OR M6 == true


H√†nh vi h·ªá th·ªëng

Kh√¥ng kh√≥a nghi·ªáp v·ª•

G·∫Øn billing_warning = true

Ghi pre_billing_start_at = now()

4.3 PRE_BILLING ‚Üí PAID_ACTIVE

ƒêi·ªÅu ki·ªán

Ng∆∞·ªùi d√πng ch·ªçn g√≥i

Thanh to√°n th√†nh c√¥ng

4.4 PRE_BILLING ‚Üí SUSPENDED

ƒêi·ªÅu ki·ªán

Qu√° th·ªùi gian ƒë·ªám (grace period)

Kh√¥ng thanh to√°n

GRACE_PERIOD_DAYS: 30

4.5 SUSPENDED ‚Üí PAID_ACTIVE

Thanh to√°n th√†nh c√¥ng

Kh√¥ng m·∫•t d·ªØ li·ªáu

5. H√†nh vi UI / UX theo tr·∫°ng th√°i
5.1 FREE_ACTIVE

Kh√¥ng hi·ªÉn th·ªã gi√°

Kh√¥ng banner qu·∫£ng c√°o

Kh√¥ng countdown

5.2 PRE_BILLING

Hi·ªÉn th·ªã r·∫•t nh·∫π:

üü° Doanh nghi·ªáp ƒë√£ v∆∞·ª£t m·ª©c mi·ªÖn ph√≠.
Vui l√≤ng ch·ªçn g√≥i ph√π h·ª£p tr∆∞·ªõc ng√†y DD/MM/YYYY.


Kh√¥ng popup c∆∞·ª°ng b·ª©c

Kh√¥ng ch·∫∑n l∆∞u b√∫t to√°n

Cho xem:

s·ªë li·ªáu ƒëang v∆∞·ª£t

g√≥i ph√π h·ª£p ƒë·ªÅ xu·∫•t

5.3 SUSPENDED

Cho xem d·ªØ li·ªáu

Cho xu·∫•t d·ªØ li·ªáu

Kh√¥ng cho t·∫°o m·ªõi:

b√∫t to√°n

h√≥a ƒë∆°n

b√°o c√°o k·ª≥ m·ªõi

‚ö†Ô∏è Kh√¥ng ƒë∆∞·ª£c kh√≥a to√†n b·ªô h·ªá th·ªëng.

6. Nguy√™n t·∫Øc t√≠nh ph√≠ (Pricing Principles)
6.1 Kh√¥ng bao gi·ªù t√≠nh ph√≠ theo:

S·ªë b√∫t to√°n l·∫ª

L·∫ßn s·ª≠a / x√≥a

Import / AI agent ch·∫°y

6.2 T√≠nh ph√≠ theo:

Th·ªùi gian (th√°ng/nƒÉm)

G√≥i quy m√¥

Ph·∫ßn h√†nh m·ªü

7. G·ª£i √Ω mapping g√≥i (tham kh·∫£o)
G√≥i	CLS	ƒê·∫∑c ƒëi·ªÉm
Free	FREE_ACTIVE	DN m·ªõi
Growth	PAID_ACTIVE	DN ·ªïn ƒë·ªãnh
Pro	PAID_ACTIVE	X√¢y l·∫Øp / SX
Enterprise	PAID_ACTIVE	Custom
8. Edge Cases (b·∫Øt bu·ªôc x·ª≠ l√Ω)
8.1 DN ng·ª´ng ho·∫°t ƒë·ªông

Kh√¥ng ph√°t sinh ‚Üí kh√¥ng reset tr·∫°ng th√°i

CLS gi·ªØ nguy√™n

8.2 DN v∆∞·ª£t ng∆∞·ª°ng r·ªìi quay l·∫°i

Kh√¥ng rollback CLS

ƒê√£ PRE_BILLING th√¨ kh√¥ng quay v·ªÅ FREE

8.3 Import d·ªØ li·ªáu l·ªõn ban ƒë·∫ßu

C√≥ flag:

is_initial_migration: true


Kh√¥ng t√≠nh v√†o M1 trong X ng√†y ƒë·∫ßu

9. Logging & Audit (b·∫Øt bu·ªôc)

M·ªói l·∫ßn thay ƒë·ªïi CLS ph·∫£i log:

{
  "company_id": "...",
  "from_state": "FREE_ACTIVE",
  "to_state": "PRE_BILLING",
  "trigger": "journal_entries",
  "value": 1024,
  "timestamp": "..."
}

10. Nguy√™n t·∫Øc v√†ng (developer MUST NOT break)

Kh√¥ng kh√≥a nghi·ªáp v·ª• k·∫ø to√°n ƒëang l√†m

Kh√¥ng surprise billing

Kh√¥ng ƒë·∫øm ti·ªÅn theo thao t√°c

Billing l√† tr·∫°ng th√°i, kh√¥ng ph·∫£i n√∫t b·∫•m