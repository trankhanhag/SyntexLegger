ƒê√¢y l√† b·∫£n t·ªïng h·ª£p chi ti·∫øt to√†n b·ªô d·ª± √°n (Product Design Specification). B·∫£n t√†i li·ªáu n√†y ƒë√≥ng vai tr√≤ l√† "x∆∞∆°ng s·ªëng" ƒë·ªÉ ƒë·ªôi ng≈© k·ªπ thu·∫≠t (Dev Team) v√† thi·∫øt k·∫ø (Product Team) c√≥ th·ªÉ b·∫Øt tay v√†o x√¢y d·ª±ng s·∫£n ph·∫©m.

H·ªí S∆† THI·∫æT K·∫æ S·∫¢N PH·∫®M: FINEXCEL PRO (T√™n d·ª± ki·∫øn)
M√¥ h√¨nh: Hybrid Spreadsheet Accounting System (K·∫ø to√°n lai b·∫£ng t√≠nh)

1. Tri·∫øt l√Ω s·∫£n ph·∫©m & Gi√° tr·ªã c·ªët l√µi
T·∫ßm nh√¨n: X√≥a b·ªè ranh gi·ªõi gi·ªØa s·ª± linh ho·∫°t c·ªßa Excel v√† s·ª± ch·∫∑t ch·∫Ω c·ªßa ph·∫ßn m·ªÅm k·∫ø to√°n.

ƒê·ªëi t∆∞·ª£ng m·ª•c ti√™u: K·∫ø to√°n d·ªãch v·ª• (Service Accountants) ‚Äì Nh·ªØng ng∆∞·ªùi c·∫ßn x·ª≠ l√Ω kh·ªëi l∆∞·ª£ng d·ªØ li·ªáu l·ªõn cho nhi·ªÅu c√¥ng ty v·ªõi t·ªëc ƒë·ªô cao nh·∫•t.

Nguy√™n t·∫Øc thi·∫øt k·∫ø (Design Principles):

Excel-First Interface: Giao di·ªán l∆∞·ªõi (Grid) l√† trung t√¢m. Kh√¥ng d√πng form nh·∫≠p li·ªáu pop-up truy·ªÅn th·ªëng.

Zero-Entry (Kh√¥ng nh·∫≠p tay): ∆Øu ti√™n Import v√† Auto-mapping. B√†n ph√≠m ch·ªâ d√πng ƒë·ªÉ s·ª≠a l·ªói (Review), kh√¥ng d√πng ƒë·ªÉ g√µ t·ª´ ƒë·∫ßu.

Flexible but Strict: Cho ph√©p nh·∫≠p li·ªáu t·ª± do ·ªü v√πng ƒë·ªám (Staging), nh∆∞ng ki·ªÉm so√°t ch·∫∑t ch·∫Ω khi ghi s·ªï (Posting).

2. Lu·ªìng ho·∫°t ƒë·ªông (Operational Workflow)
H·ªá th·ªëng ho·∫°t ƒë·ªông theo c∆° ch·∫ø "Ph·ªÖu l·ªçc 3 b∆∞·ªõc":

B∆∞·ªõc 1: Ingest (N·∫°p d·ªØ li·ªáu th√¥)
H√†nh ƒë·ªông: User k√©o th·∫£ file XML (H√≥a ƒë∆°n), Excel (Sao k√™ ng√¢n h√†ng), CSV v√†o h·ªá th·ªëng.

H·ªá th·ªëng: ƒê·ªçc file, gi·ªØ nguy√™n d·ªØ li·ªáu g·ªëc, ƒë·∫©y v√†o b·∫£ng t·∫°m (Staging). Ch∆∞a ki·ªÉm tra ƒë√∫ng sai k·∫ø to√°n.

B∆∞·ªõc 2: Refine (Tinh ch·ªânh tr√™n Grid) - Giai ƒëo·∫°n quan tr·ªçng nh·∫•t
Giao di·ªán: Hi·ªÉn th·ªã d·ªØ li·ªáu l√™n l∆∞·ªõi Excel.

T·ª± ƒë·ªông h√≥a: H·ªá th·ªëng ch·∫°y thu·∫≠t to√°n "Smart Mapping" ƒë·ªÉ ƒëi·ªÅn s·∫µn TK N·ª£/C√≥, M√£ ƒë·ªëi t∆∞·ª£ng.

T∆∞∆°ng t√°c ng∆∞·ªùi d√πng:

C√°c d√≤ng Xanh (Valid): B·ªè qua.

C√°c d√≤ng ƒê·ªè (Error): User l·ªçc ra, d√πng thao t√°c "K√©o c√¥ng th·ª©c" (Drag-fill) ho·∫∑c "Find & Replace" ƒë·ªÉ s·ª≠a h√†ng lo·∫°t.

V√≠ d·ª•: L·ªçc to√†n b·ªô n·ªôi dung "Ph√≠ chuy·ªÉn ti·ªÅn", ƒëi·ªÅn 6425 v√†o √¥ ƒë·∫ßu, click ƒë√∫p ƒë·ªÉ ƒëi·ªÅn cho 100 d√≤ng d∆∞·ªõi.

B∆∞·ªõc 3: Post (Ghi s·ªï c√°i)
H√†nh ƒë·ªông: User nh·∫•n n√∫t "GHI S·ªî".

H·ªá th·ªëng:

Validate l·∫ßn cu·ªëi (C√¢n b·∫±ng N·ª£/C√≥, M√£ t·ªìn t·∫°i).

Chuy·ªÉn d·ªØ li·ªáu t·ª´ Staging sang General Ledger.

Kh√≥a d√≤ng d·ªØ li·ªáu (kh√¥ng cho s·ª≠a t√πy ti·ªán n·ªØa).

C·∫≠p nh·∫≠t s·ªë d∆∞ c√°c t√†i kho·∫£n ngay l·∫≠p t·ª©c.

3. Ki·∫øn tr√∫c C∆° s·ªü d·ªØ li·ªáu (Database Schema)
S·ª≠ d·ª•ng PostgreSQL ƒë·ªÉ ƒë·∫£m b·∫£o hi·ªáu nƒÉng v√† t√≠nh linh ho·∫°t (JSONB).

A. B·∫£ng V√πng ƒë·ªám (Staging Table)
N∆°i ch·ª©a d·ªØ li·ªáu ƒëang thao t√°c tr√™n l∆∞·ªõi Excel.

SQL

CREATE TABLE staging_transactions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    batch_id UUID NOT NULL,             -- M√£ l√¥ nh·∫≠p li·ªáu (ƒë·ªÉ qu·∫£n l√Ω theo ƒë·ª£t)
    row_index INT,                      -- Th·ª© t·ª± d√≤ng hi·ªÉn th·ªã tr√™n Grid
    
    -- D·ªØ li·ªáu hi·ªÉn th·ªã tr√™n Grid (Cho ph√©p Null ƒë·ªÉ user ƒëi·ªÅn sau)
    trx_date DATE,
    doc_no VARCHAR(50),                 -- S·ªë ch·ª©ng t·ª´ (PC001,...)
    description TEXT,
    debit_acc VARCHAR(20),              -- TK N·ª£
    credit_acc VARCHAR(20),             -- TK C√≥
    amount DECIMAL(15, 2),
    partner_code VARCHAR(50),           -- M√£ ƒë·ªëi t∆∞·ª£ng
    
    -- Tr·∫°ng th√°i & Logic
    is_valid BOOLEAN DEFAULT FALSE,     -- True = Hi·ªán m√†u xanh, False = Hi·ªán m√†u ƒë·ªè
    error_log TEXT,                     -- L√Ω do l·ªói (ƒë·ªÉ hi·ªán tooltip)
    
    -- D·ªØ li·ªáu g·ªëc (D√πng JSONB ƒë·ªÉ l∆∞u m·ªçi c·ªôt th·ª´a t·ª´ Excel/XML g·ªëc)
    raw_data JSONB                      
);

-- Index ƒë·ªÉ load Grid nhanh
CREATE INDEX idx_staging_batch ON staging_transactions(batch_id, row_index);
B. B·∫£ng S·ªï c√°i (General Ledger - Core)
N∆°i ch·ª©a d·ªØ li·ªáu k·∫ø to√°n ch√≠nh th·ª©c ("Source of Truth").

SQL

CREATE TABLE general_ledger (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    trx_date DATE NOT NULL,
    posted_at TIMESTAMP DEFAULT NOW(),
    
    doc_no VARCHAR(50),
    description TEXT,
    
    -- ƒê·ªãnh kho·∫£n (B·∫Øt bu·ªôc c√≥ d·ªØ li·ªáu)
    account_code VARCHAR(20) NOT NULL,  -- T√†i kho·∫£n ch√≠nh (ƒë·ªÉ l√™n S·ªï c√°i, CƒêPS)
    reciprocal_acc VARCHAR(20),         -- T√†i kho·∫£n ƒë·ªëi ·ª©ng (ƒë·ªÉ l√†m S·ªï chi ti·∫øt)
    
    debit_amount DECIMAL(15, 2) DEFAULT 0,
    credit_amount DECIMAL(15, 2) DEFAULT 0,
    
    partner_code VARCHAR(50),
    
    -- Truy v·∫øt
    origin_staging_id UUID              -- Link ng∆∞·ª£c v·ªÅ d√≤ng Staging g·ªëc
);

CREATE INDEX idx_gl_date ON general_ledger(trx_date);
CREATE INDEX idx_gl_account ON general_ledger(account_code);
C. B·∫£ng Quy t·∫Øc T·ª± ƒë·ªông (Automation Rules)
SQL

CREATE TABLE mapping_rules (
    id UUID PRIMARY KEY,
    keyword VARCHAR(100),               -- VD: "ph√≠ duy tr√¨", "xƒÉng d·∫ßu"
    
    -- H√†nh ƒë·ªông g√°n t·ª± ƒë·ªông
    target_debit VARCHAR(20),           -- T·ª± ƒëi·ªÅn N·ª£ 642
    target_credit VARCHAR(20),          -- T·ª± ƒëi·ªÅn C√≥ 112
    target_partner VARCHAR(50),         -- T·ª± ƒëi·ªÅn M√£ NCC
    
    priority INT DEFAULT 1              -- ƒê·ªô ∆∞u ti√™n
);
4. Logic X·ª≠ l√Ω & Giao di·ªán (Frontend Logic)
Giao di·ªán Grid (UI Specifications)
Th∆∞ vi·ªán ƒë·ªÅ xu·∫•t: AG Grid Enterprise ho·∫∑c Handsontable.

C√°c c·ªôt b·∫Øt bu·ªôc:

Status (Icon): üî¥ (L·ªói), üü° (C·∫£nh b√°o), üü¢ (S·∫µn s√†ng).

Ng√†y CT, S·ªë CT: Format chu·∫©n Date/String.

TK N·ª£ / TK C√≥: Dropdown c√≥ t√≠nh nƒÉng Search (g√µ "ti·ªÅn" ra 111, 112).

S·ªë ti·ªÅn: Format ph√¢n c√°ch h√†ng ngh√¨n, cƒÉn ph·∫£i.

T√≠nh nƒÉng Excel b·∫Øt bu·ªôc:

Drag-handle: K√©o g√≥c √¥ ƒë·ªÉ copy d·ªØ li·ªáu xu·ªëng d∆∞·ªõi.

Keyboard Navigation: Di chuy·ªÉn b·∫±ng ph√≠m m≈©i t√™n.

Paste Special: Paste d·ªØ li·ªáu t·ª´ Excel ngo√†i v√†o, t·ª± ƒë·ªông map c·ªôt.

Logic "Smart Mapping" (Backend Job)
Khi file ƒë∆∞·ª£c upload, server ch·∫°y lu·ªìng sau:

Normalization: Chu·∫©n h√≥a chu·ªói (vi·∫øt th∆∞·ªùng, b·ªè d·∫•u ti·∫øng Vi·ªát ƒë·ªÉ so s√°nh).

Lookup:

Qu√©t mapping_rules: N·∫øu description ch·ª©a keyword -> G√°n target_debit/credit.

Qu√©t partners: N·∫øu tax_code (trong XML) kh·ªõp -> G√°n partner_code.

Validation:

Ki·ªÉm tra account_code c√≥ trong chart_of_accounts kh√¥ng?

Ki·ªÉm tra debit = credit (n·∫øu t√°ch d√≤ng)?

N·∫øu sai -> Update is_valid = false, error_log = "M√£ TK kh√¥ng t·ªìn t·∫°i".